<app-modal 
  [isOpen]="isOpen()" 
  [title]="'Configuración'"
  (closeModal)="onClose()"
>
  <div class="config-form">
    <!-- Ruta de vídeos -->
    <div class="config-field">
      <label class="config-label">
        <span class="material-icons">folder</span>
        Carpeta de música
      </label>
      <p class="config-description">
        Selecciona la carpeta donde se encuentran tus archivos de música.
      </p>
      <div class="path-input-group">
        <input 
          type="text" 
          class="config-input"
          [ngModel]="videosPath()"
          (ngModelChange)="videosPath.set($event)"
          placeholder="C:\Users\tu-usuario\Music"
        >
        <button class="browse-btn" (click)="onBrowse()" title="Seleccionar carpeta">
          <span class="material-icons">folder_open</span>
        </button>
      </div>
      
      <!-- Botón de escaneo -->
      <button 
        class="scan-btn" 
        (click)="onScan()" 
        [disabled]="isScanning() || !videosPath()"
      >
        @if (isScanning()) {
          <span class="material-icons spinning">refresh</span>
          Escaneando...
        } @else {
          <span class="material-icons">library_music</span>
          Escanear biblioteca
        }
      </button>
      
      <!-- Resultado del escaneo -->
      @if (scanResult()) {
        <div class="scan-result" [class.has-errors]="scanResult()!.errors > 0">
          <div class="scan-stats">
            <span class="stat">
              <span class="material-icons">music_note</span>
              {{ scanResult()!.totalFiles }} archivos
            </span>
            <span class="stat new">
              <span class="material-icons">add_circle</span>
              {{ scanResult()!.newSongs }} nuevas
            </span>
            <span class="stat updated">
              <span class="material-icons">update</span>
              {{ scanResult()!.updatedSongs }} actualizadas
            </span>
            @if (scanResult()!.errors > 0) {
              <span class="stat error">
                <span class="material-icons">error</span>
                {{ scanResult()!.errors }} errores
              </span>
            }
          </div>
        </div>
      }
    </div>
    
    <!-- Separador -->
    <div class="config-separator"></div>
    
    <!-- API Keys Section -->
    <div class="config-section">
      <h3 class="section-title">
        <span class="material-icons">key</span>
        API Keys (IA)
      </h3>
      <p class="section-description">
        Configura las API keys para las funciones de IA.
      </p>
      
      <!-- OpenAI API Key -->
      <div class="api-key-field">
        <label class="config-label">
          <span class="material-icons">smart_toy</span>
          OpenAI API Key
        </label>
        @if (openaiKeyMasked()) {
          <div class="key-status configured">
            <span class="material-icons">check_circle</span>
            <span>Configurada: {{ openaiKeyMasked() }}</span>
            <button class="delete-key-btn" (click)="deleteApiKey('openai_api_key')" title="Eliminar">
              <span class="material-icons">delete</span>
            </button>
          </div>
        }
        <div class="api-key-input-group">
          <input 
            type="password" 
            class="config-input"
            [ngModel]="openaiApiKey()"
            (ngModelChange)="openaiApiKey.set($event)"
            placeholder="sk-..."
            autocomplete="off"
          >
          <button 
            class="save-key-btn" 
            (click)="saveOpenAIKey()"
            [disabled]="savingOpenAI() || !openaiApiKey()"
          >
            @if (savingOpenAI()) {
              <span class="material-icons spinning">refresh</span>
            } @else {
              <span class="material-icons">save</span>
            }
          </button>
        </div>
      </div>
      
      <!-- Replicate API Key -->
      <div class="api-key-field">
        <label class="config-label">
          <span class="material-icons">record_voice_over</span>
          Replicate API Key (TTS)
        </label>
        @if (replicateKeyMasked()) {
          <div class="key-status configured">
            <span class="material-icons">check_circle</span>
            <span>Configurada: {{ replicateKeyMasked() }}</span>
            <button class="delete-key-btn" (click)="deleteApiKey('replicate_api_key')" title="Eliminar">
              <span class="material-icons">delete</span>
            </button>
          </div>
        }
        <div class="api-key-input-group">
          <input 
            type="password" 
            class="config-input"
            [ngModel]="replicateApiKey()"
            (ngModelChange)="replicateApiKey.set($event)"
            placeholder="r8_..."
            autocomplete="off"
          >
          <button 
            class="save-key-btn" 
            (click)="saveReplicateKey()"
            [disabled]="savingReplicate() || !replicateApiKey()"
          >
            @if (savingReplicate()) {
              <span class="material-icons spinning">refresh</span>
            } @else {
              <span class="material-icons">save</span>
            }
          </button>
        </div>
      </div>
    </div>
    
    <!-- Acciones -->
    <div class="config-actions">
      <button class="btn-cancel" (click)="onClose()">
        Cancelar
      </button>
      <button class="btn-save" (click)="onSave()">
        <span class="material-icons">save</span>
        Guardar
      </button>
    </div>
  </div>
</app-modal>
