<aside class="sidebar right-sidebar" [class.open]="activeView() !== null">
  @if (activeView() === 'ranking') {
    <div class="sidebar-content ranking-view">
      <div class="sidebar-header">
        <h3>
          <span class="material-icons header-icon">military_tech</span>
          Mi Ranking
        </h3>
        <span class="ranking-count">{{ rankedSongs().length }} canciones</span>
      </div>
      
      @if (loadingRanking()) {
        <div class="loading-state">
          <span class="material-icons spinning">autorenew</span>
          <p>Cargando...</p>
        </div>
      } @else if (rankedSongs().length === 0) {
        <div class="ranking-empty">
          <span class="material-icons">emoji_events</span>
          <p>Tu ranking está vacío</p>
          <span class="hint">Añade canciones desde la carátula</span>
        </div>
      } @else {
        <div class="ranking-list" cdkDropList (cdkDropListDropped)="onRankingDrop($event)">
          @for (song of rankedSongs(); track song.id; let i = $index) {
            <div 
              class="ranking-item" 
              cdkDrag
              [class.current]="song.id === currentSongId()"
              (click)="onPlayFromRanking(song)"
            >
              <div class="drag-handle" cdkDragHandle>
                <span class="material-icons">drag_indicator</span>
              </div>
              <span class="rank-position">{{ i + 1 }}</span>
              <div class="song-info">
                <span class="song-title">{{ song.title }}</span>
                <span class="song-artist">{{ song.artist }}</span>
              </div>
              <span class="song-duration">{{ formatDuration(song.duration) }}</span>
              <button 
                class="remove-btn" 
                (click)="removeFromRanking(song, $event)"
                title="Quitar del ranking"
              >
                <span class="material-icons">close</span>
              </button>
            </div>
          }
        </div>
      }
    </div>
  }
  
  @if (activeView() === 'playlist') {
    <div class="sidebar-content">
      <h3>Playlists</h3>
      <div class="playlist-list">
        @for (playlist of playlists(); track playlist.id) {
          <div class="playlist-item" [class.contains-current]="isInPlaylist(playlist.id)">
            <button 
              class="play-btn" 
              (click)="onPlayPlaylist(playlist.id)"
              title="Reproducir playlist"
            >
              <span class="material-icons">play_arrow</span>
            </button>
            <span class="material-icons playlist-icon">{{ playlist.icon }}</span>
            <div class="playlist-info">
              <span class="playlist-name">{{ playlist.name }}</span>
              <span class="playlist-count">{{ playlist.songCount }} canciones</span>
            </div>
            @if (isInPlaylist(playlist.id)) {
              <button 
                class="remove-btn" 
                (click)="onRemoveFromPlaylist(playlist.id)"
                title="Quitar canción de esta playlist"
              >
                <span class="material-icons">remove</span>
              </button>
            } @else {
              <button 
                class="add-btn" 
                (click)="onAddToPlaylist(playlist.id)"
                title="Agregar canción actual"
              >
                <span class="material-icons">add</span>
              </button>
            }
          </div>
        }
      </div>
      <button class="create-playlist-btn">
        <span class="material-icons">add</span>
        Nueva playlist
      </button>
    </div>
  }
  
  @if (activeView() === 'queue') {
    <div class="sidebar-content">
      <h3>Próximas</h3>
      <p class="queue-label">A continuación:</p>
      <div class="song-list">
        @for (song of queue; track song.id; let i = $index) {
          <div class="song-item">
            <span class="queue-number">{{ i + 1 }}</span>
            <div class="song-item-info">
              <span class="song-item-title">{{ song.title }}</span>
              <span class="song-item-artist">{{ song.artist }}</span>
            </div>
            <span class="song-item-duration">{{ song.duration }}</span>
          </div>
        }
      </div>
      @if (queue.length === 0) {
        <p class="empty-message">No hay canciones en la cola</p>
      }
    </div>
  }
</aside>
