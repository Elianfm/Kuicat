<div class="now-playing-card">
  <!-- Barra superior con label y ranking controls -->
  <div class="card-header">
    <span class="card-label">Now Playing</span>
    
    <!-- Ranking controls -->
    <div class="ranking-controls-wrapper">
      @if (rankPosition()) {
        <!-- Est谩 rankeada: mostrar controles -->
        <div class="ranking-controls">
          <!-- Bot贸n subir -->
          <button 
            class="rank-arrow-btn" 
            [disabled]="rankPosition() === 1"
            (click)="onMoveUp()"
          >
            <span class="material-icons">keyboard_arrow_up</span>
            <!-- Tooltip rico -->
            @if (prevNeighbor) {
              <div class="rank-tooltip rank-tooltip-up">
                <span class="tooltip-action">Subir a #{{ rankPosition()! - 1 }}</span>
                <div class="tooltip-song">
                  <img [src]="prevNeighborCover" alt="" class="tooltip-cover">
                  <div class="tooltip-info">
                    <span class="tooltip-title">{{ prevNeighbor.title }}</span>
                    <span class="tooltip-artist">{{ prevNeighbor.artist }}</span>
                  </div>
                </div>
              </div>
            }
          </button>
          
          <!-- Posici贸n actual -->
          <span class="rank-position">
            <span class="material-icons trophy-icon">emoji_events</span>
            {{ rankPosition() }}
          </span>
          
          <!-- Bot贸n bajar -->
          <button 
            class="rank-arrow-btn" 
            [disabled]="rankPosition() === effectiveTotalRanked"
            (click)="onMoveDown()"
          >
            <span class="material-icons">keyboard_arrow_down</span>
            <!-- Tooltip rico -->
            @if (nextNeighbor) {
              <div class="rank-tooltip rank-tooltip-down">
                <span class="tooltip-action">Bajar a #{{ rankPosition()! + 1 }}</span>
                <div class="tooltip-song">
                  <img [src]="nextNeighborCover" alt="" class="tooltip-cover">
                  <div class="tooltip-info">
                    <span class="tooltip-title">{{ nextNeighbor.title }}</span>
                    <span class="tooltip-artist">{{ nextNeighbor.artist }}</span>
                  </div>
                </div>
              </div>
            }
          </button>
          
          <!-- Bot贸n quitar del ranking -->
          <button class="rank-remove-btn" (click)="onRemoveFromRanking()" title="Quitar del ranking">
            <span class="material-icons">close</span>
          </button>
        </div>
      } @else {
        <!-- No est谩 rankeada: mostrar bot贸n para a帽adir -->
        <button class="ranking-add-btn" (click)="onAddToRanking()">
          <span class="material-icons">military_tech</span>
          <span class="add-label">Sin ranking</span>
        </button>
      }
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="card-content">
    @if (isPlayingRadio()) {
      <img src="img/radio-cover.webp" alt="Radio" class="card-cover radio-cover">
      <div class="card-info">
        <span class="card-title"> Radio Kuicat</span>
        <span class="card-artist">Anuncio en curso...</span>
      </div>
    } @else {
      <img [src]="cover()" alt="Cover" class="card-cover">
      <div class="card-info">
        <span class="card-title">{{ title() }}</span>
        <span class="card-artist">{{ artist() }}</span>
      </div>
    }
    
    <!-- Bot贸n agregar a playlist -->
    <div class="add-to-playlist">
      <button class="add-btn" (click)="toggleDropdown()" title="Agregar a playlist">
        <span class="material-icons">{{ showPlaylistDropdown() ? 'close' : 'playlist_add' }}</span>
      </button>
      
      @if (showPlaylistDropdown()) {
        <div class="playlist-dropdown">
          <span class="dropdown-title">Playlists:</span>
          @for (playlist of playlistsWithStatus(); track playlist.id) {
            <button 
              class="dropdown-item" 
              [class.in-playlist]="playlist.hasSong"
              (click)="onTogglePlaylist(playlist)"
            >
              <span class="material-icons playlist-icon">{{ playlist.icon }}</span>
              <span class="playlist-name">{{ playlist.name }}</span>
              <span class="material-icons action-icon">
                {{ playlist.hasSong ? 'remove_circle' : 'add_circle' }}
              </span>
            </button>
          }
          @empty {
            <span class="dropdown-empty">No hay playlists</span>
          }
        </div>
      }
    </div>
  </div>
</div>
